<!-- <script src="http://jetienne.tquery-multiplayerserver.jit.su/socket.io/socket.io.js"></script>
 -->
 
<script src="/socket.io/socket.io.js"></script>
<textarea cols="30" rows="5" id='chatOutput' style='overflow-y: scroll;'></textarea>
<form action="javascript:void(0)" id='chatInputForm'>
	Message: <input type="text"/>
</form>

<form action="javascript:void(0)" id='nicknameForm'>
	nickname: <input type="text"/>
</form>
<script>
	var socket	= io.connect();
	//var socket = io.connect('http://jetienne.tquery-multiplayerserver.jit.su:80/');

// TODO to change
	var localName	= "browser-"+Math.floor(Math.random()*10)
	console.log('name', localName)

	// ping server every seconds
	setInterval(function(){
		//socket.emit('ping', { time	: Date.now() });
	}, 1000)
	socket.on('pong', function(data){
		console.log('received pong. rtt ', Date.now() - data.time, 'ms');
	});

	document.getElementById('nicknameForm').addEventListener('submit', function(){
		var formElement	= document.getElementById('nicknameForm');
		var inputValue	= formElement[0].value;
		socket.emit('nickRequest', inputValue);
	});
	// socket.on('nickResponse', function(data){
		
	// });

	// listen to chat text input	
	document.getElementById('chatInputForm').addEventListener('submit', function(){
		var formElement	= document.getElementById('chatInputForm');
		socket.emit('clientBroadcast', {
			type	: 'say',
			data	: {
				text	: formElement[0].value
			}
		});
		formElement[0].value	= null;
	});

	socket.on('clientBroadcast', function(data){
		console.log('received clientBroadcast', JSON.stringify(data, null, '\t'))
		if( data.type === 'say' ){
			var chatOutput	=  document.getElementById('chatOutput');
			var text	=  data.data.text;
			chatOutput.value+= text+'\n';
			// force the element to scroll
			chatOutput.scrollTop = chatOutput.scrollHeight;
		}
	});

	socket.emit('hello', {
		humanName	: localName
	});
	socket.on('hello', function(data){
		console.log('received hello', JSON.stringify(data, null, '\t'))
	});
	socket.on('bye', function(data){
		console.log('received bye ', JSON.stringify(data, null, '\t'));
	});
	
	socket.on('userlist', function(data){
		console.log('userlist', JSON.stringify(data, null, '\t'));
	});
</script>


<a href="https://github.com/jeromeetienne/tquery-multiplayerserver"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>