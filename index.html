<!-- <script src="http://jetienne.tquery-multiplayerserver.jit.su/socket.io/socket.io.js"></script>
 -->
 
<script src="/socket.io/socket.io.js"></script>
<textarea cols="30" rows="5" id='chatOutput'></textarea>
<form action="javascript:void(0)" id='chatInput'>
	Message: <input type="text"/>
	<input type="submit" value="Submit" />
</form>
<script>
	var socket	= io.connect();
	//var socket = io.connect('http://jetienne.tquery-multiplayerserver.jit.su:80/');

	var localName	= "browser-"+Math.floor(Math.random()*10)
	console.log('name', localName)

	// ping server every seconds
	setInterval(function(){
		//socket.emit('ping', { time	: Date.now() });
	}, 1000)
	socket.on('pong', function(data){
		console.log('received pong. rtt ', Date.now() - data.time, 'ms');
	});

	// listen to chat text input	
	var formElement	= document.getElementById('chatInput');
	formElement.addEventListener('submit', function(){
		socket.emit('clientBroadcast', {
			type	: 'say',
			data	: {
				text	: formElement[0].value
			}
		});
		formElement[0].value	= null;
	});

	socket.on('clientBroadcast', function(data){
		console.log('received clientBroadcast', JSON.stringify(data, null, '\t'))
		if( data.type	=== 'say' ){
			var chatOutput	= document.getElementById('chatOutput');
			console.log("say", data.data.text)
			var text	= data.data.text;
			chatOutput.value	+= text;
		}
	});



	socket.emit('hello', {
		humanName	: localName
	});
	socket.on('hello', function(data){
		console.log('received hello', JSON.stringify(data, null, '\t'))
	});

	socket.on('bye', function(data){
		console.log('received bye ', JSON.stringify(data, null, '\t'));
	});
	
	socket.on('userlist', function(data){
		console.log('userlist', JSON.stringify(data, null, '\t'));
	});
</script>